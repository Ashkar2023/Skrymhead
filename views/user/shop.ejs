<!DOCTYPE html>
<html lang="en">

<head>
	<title>Shop</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.png" />
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css"> -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css"> -->
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css"> -->
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css"> -->
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css"> -->
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="vendor/MagnificPopup/magnific-popup.css"> -->
	<!--===============================================================================================-->
	<!-- <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css"> -->
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/fonts.css">
	<!--===============================================================================================-->
</head>

<body class="animsition">

	<!-- Header -->
	<header class="">
		<nav class="navbar navbar-expand-md border-bottom fixed-top bg-white border-3 border-black">
			<div class="container-fluid justify-content-around justify-content-md-between ms-lg-5 ms-md-5 me-lg-5">
				<a class="navbar-brand d-flex align-items-center" href="/home">
					<svg width="38" height="48" viewBox="0 0 38 48" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M34 1H4L1 5.63571M34 1L37 5.63571L25 24.1786M34 1L22 19.5429M1 5.63571H25L19 14.9071L16 10.2714M1 5.63571L16 28.8143L4 47.3571M1 5.63571L22 38.0857H16H28L10 10.2714M16 10.2714L28 28.8143M16 10.2714L37 42.7214M22 10.2714H10M10 10.2714L22 28.8143M37 42.7214L34 47.3571H4M37 42.7214H13L19 33.45M4 47.3571L1 42.7214L13 24.1786" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
					<h1 class="m-2 text-dark koulen">SKRYMHEAD</h1>
				</a>
	
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
					aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				
				<div class="collapse navbar-collapse me-5" id="navbarNav">
					<ul class="navbar-nav ms-auto">
						<li class="nav-item">
							<a class="nav-link" href="/home">Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="/shop">Shop</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Categories</a>
						</li>
					</ul>
				</div>
				
				
	
				<div class="navbar-text me-5 d-flex">
					<div class="wrap-icon-header flex-w flex-r-m">
						<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search" onclick="focusInput()">
							<i class="zmdi zmdi-search"></i>
						</div>
	
						<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-account">
							<a href="/profile" style="color:inherit"><i class="zmdi zmdi-account-o"></i></a>
						</div>
	
						<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti" id="cartNotify" data-notify="<%= cartitems %>">
							<a href="/cart"><i class="zmdi zmdi-shopping-cart"></i></a>
						</div>
	
						
					</div>
				</div>
			</div>
		</nav>

		<div class="modal-search-header d-flex justify-content-center trans-04 js-hide-modal-search">
			<div class="container-search-header">
				<form class="wrap-search-header flex-w p-l-15">
					<button class="flex-c-m trans-04">
						<i class="zmdi zmdi-search"></i>
					</button>
					<input class="plh3" type="text" name="look" placeholder="Search..." spellcheck="false">
				</form>
				
				<button class="flex-c-m btn-hide-modal-search trans-04 js-hide-modal-search" onclick="clearInput()">
					<img src="images/icons/icon-close2.png" alt="CLOSE">
				</button>

				<div id="searchResultWrapper">
					<ul id="searchResults">
					</ul>
				</div>

			</div>
		</div>
	</header>

	<script src="/js/search.js"></script>


	<!-- filters -->
	<div class="bg0 m-t-90 p-b-140">
		<div class="container">

			<div class="flex-w flex-sb-m p-b-20 justify-content-end">
			
				<div class="flex-w flex-c-m m-tb-10">
					<div class="flex-c-m stext-106 cl6 size-104 bor4 pointer hov-btn3 trans-04 m-r-8 m-tb-4 js-show-filter">
						<i class="icon-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-filter-list"></i>
						<i class="icon-close-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
						Filter
					</div>
			
					<div class="flex-c-m stext-106 cl6 size-105 bor4 pointer hov-btn3 trans-04 m-tb-4 js-show-search">
						<i class="icon-search cl2 m-r-6 fs-15 trans-04 zmdi zmdi-search"></i>
						<i class="icon-close-search cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
						Search
					</div>
				</div>
			
				<!-- Search product -->
				<div class="dis-none panel-search w-full p-t-10 p-b-15">
					<div class="bor8 dis-flex p-l-15">
						<button class="size-113 flex-c-m fs-16 cl2 hov-cl1 trans-04">
							<i class="zmdi zmdi-search"></i>
						</button>
			
						<input class="mtext-107 cl2 size-114 plh2 p-r-15" type="text" name="search-product" placeholder="Search">
					</div>
				</div>
			
				<!-- Filter -->
				<div class="dis-none panel-filter w-full p-t-10">
					<form id="filterForm">
						<div class="mtext-100 wrap-filter flex-w bg6 w-full p-lr-40 p-t-27 p-lr-15-sm">
							<div class="filter-col1 p-r-15 p-b-27">
								<div class="koulen cl2 p-b-15">
									Sort By
								</div>
			
								<ul class="list-unstyled">
			
									<li class="mb-2">
										<div class="form-check">
											<input type="radio" class="form-check-input filter-radio" name="sort"
												id="alphabeticalAsc" value="A-Z" checked>
											<label class="form-check-label" for="alphabeticalAsc">Alphabetical: A-Z</label>
										</div>
									</li>
			
									<li class="mb-2">
										<div class="form-check">
											<input type="radio" class="form-check-input filter-radio" name="sort"
												id="alphabeticalDesc" value="Z-A">
											<label class="form-check-label" for="alphabeticalDesc">Alphabetical: Z-A</label>
										</div>
									</li>
			
									<li class="mb-2">
										<div class="form-check">
											<input type="radio" class="form-check-input filter-radio" name="sort" id="newest"
												value="newest">
											<label class="form-check-label" for="newest">Newest Arrivals</label>
										</div>
									</li>
			
									<li class="mb-2">
										<div class="form-check">
											<input type="radio" class="form-check-input filter-radio" name="sort"
												id="lowToHigh" value="L-H">
											<label class="form-check-label" for="lowToHigh">Price: Low to High</label>
										</div>
									</li>
			
									<li class="mb-2">
										<div class="form-check">
											<input type="radio" class="form-check-input filter-radio" name="sort"
												id="highToLow" value="H-L">
											<label class="form-check-label" for="highToLow">Price: High to Low</label>
										</div>
									</li>
								</ul>
			
			
							</div>
			
			
			
							<div class="filter-col2 p-r-15 p-b-27">
								<div class="koulen cl2 p-b-15">
									Price
								</div>
			
								<ul class="">
									<li class="list-group-item">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value="all" id="priceAll" name="price" checked>
											<label class="form-check-label" for="priceAll">
												All
											</label>
										</div>
									</li>
			
									<li class="list-group-item">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value="0-2500" id="0to2500" name="price">
											<label class="form-check-label" for="0to2500">
												&#x20B9; 0 - &#x20B9; 2500
											</label>
										</div>
									</li>
			
									<li class="list-group-item">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value="2500-5000" id="2500to5000" name="price">
											<label class="form-check-label" for="2500to5000">
												&#x20B9; 2500 - &#x20B9; 5000
											</label>
										</div>
									</li>
			
									<li class="list-group-item">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value="5000-10000" id="5000to10000" name="price">
											<label class="form-check-label" for="5000to10000">
												&#x20B9; 5000 - &#x20B9; 10000
											</label>
										</div>
									</li>
			
									<li class="list-group-item">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value="10000-20000" id="10000to20000" name="price">
											<label class="form-check-label" for="10000to20000">
												&#x20B9; 10000 - &#x20B9; 20000
											</label>
										</div>
									</li>
			
									<li class="list-group-item">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value="20000-100000000" id="20000above" name="price">
											<label class="form-check-label" for="20000-0">
												&#x20B9; 20000 & above
											</label>
										</div>
									</li>
								</ul>
								<script>
									$("input[value='all']").on("change", function () {
    									if($(this).prop("checked")) {
											$("input[name='price']").not(this).prop("checked",false);
										}
									})
									$("input[name='price']").not("input[value='all']").on("change", function () {
    									if($(this).prop("checked")) {
											$("input[value='all']").prop("checked",false);
										}
									})

								</script>
							</div>

							<div class="filter-col1 p-r-15 p-b-27">
								<div class="koulen cl2 p-b-15">
									Categories
								</div>
							
								<ul class="list-unstyled">
									<li class="mb-2">
										<div class="form-check">
											<input type="checkbox" class="form-check-input filter-checkbox" name="category" id="none" checked value="none">
											<label class="form-check-label" for="none">all</label>
										</div>
									</li>
									<% categories.forEach((cat)=>{ %>
										<li class="mb-2">
											<div class="form-check">
												<input type="checkbox" class="form-check-input filter-checkbox" name="category" id="<%= cat.category %>" value="<%= cat.category %>">
												<label class="form-check-label" for="<%= cat.category %>"><%= cat.category %></label>
											</div>
										</li>
									<% }) %>
								</ul>
								<script>
									$("input[value='none']").on("change", function () {
    									if($(this).prop("checked")) {
											$("input[name='category']").not(this).prop("checked",false);
										}
									})
									$("input[name='category']").not("input[value='none']").on("change", function () {
    									if($(this).prop("checked")) {
											$("input[value='none']").prop("checked",false);
										}
									})
								</script>
							</div>
							
							<div class="koulen d-flex flex-grow align-self-end p-r-15 p-b-27">
								
								<button type="button" class="btn btn-dark border border-dark rounded-1 align-self-end" id="applyFilter">Apply filters</button>
								<button type="reset" class="btn btn-white border border-dark rounded-1 ms-2 align-self-end" id="reset">Reset</button>
							</div>
						</div>
					</div>
				</form>
			</div>

			<script>
				document.addEventListener("DOMContentLoaded", () => {
					
					$('#applyFilter').on('click', function() {
						$('.panel-filter').slideUp(300,()=>{
							$('i.icon-filter').show();
							$('i.icon-close-filter').hide();
							fetchData();

						});
					});

					const form = document.querySelector("#filterForm");

					function fetchData(){
						const formData = new FormData(form)

						fetch('/filterproducts', {
							method: "POST",
							body: formData
						})
							.then(response => {
								if (response.ok) {
									return response.json();
								}else{
									return response.json().then(data=>{
										throw new Error(data.message)
									})
								}
							})
							.then(data => {
								console.log(data.success,data.products)
								updateGrid(data.products);
							})
							.catch(error => {
								console.log(error.message)
							})

					}

					function updateGrid(products) {
						let productsGrid = document.querySelector("#productsGrid");

						if(products.length<=0){
							productsGrid.innerHTML = '<p class="text-dark">No Products found</p>';
							return 
						}
						let newProducts = "";

						products.forEach(function (product) {
							let greaterOffer;
							product.product_offer >= product.category.offer ? greaterOffer = product.product_offer : greaterOffer = product.category.offer ;
							let offerPrice = product.variants.price - (greaterOffer / 100) * product.variants.price;

							newProducts += `
									<div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item">
										<a href="shop/product?id=${product._id}" class="text-decoration-none stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
											<div class="block2">
												<div class="block2-pic hov-img0">
													<img src="products/${product.brand} ${product.model}/${product.images[0].url}" alt="IMG-PRODUCT">
												</div>
												<div class="block2-txt flex-w flex-t p-t-14">
													<div class="block2-txt-child1 flex-col-l text-decoration-none">
														${product.brand} ${product.model}
														<div class="stext-105 cl3 d-flex w-100 justify-content-between">
															<p class="bi bi-currency-rupee" style="font-size: medium;">
																<span class="">${product.product_offer ? offerPrice : product.variants.price.toLocaleString("en-IN")}</span>
															</p>
															<div class="flex-r">
																${product.product_offer ?
																`<span class="me-2">${"-" + greaterOffer + "%"}</span>
																<span class="text-decoration-line-through text-danger">${product.variants.price.toLocaleString("en-IN")}</span>` :
																'<span class="mx-1"></span><span class="text-decoration-line-through text-danger"></span>'}
															</div>
														</div>
													</div>
												</div>
											</div>
										</a>
									</div>`;
						})
					
						productsGrid.innerHTML = newProducts;
						productsGrid.style.height="auto";
						productsGrid.style.minHeight="500px";
					}
				})
			</script>

			<!--\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ products ////////////////////////////////-->
			<div class="row isotope-grid" id="productsGrid">

				<% products.forEach((product)=>{ %>

					<div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item">
						<a href="shop/product?id=<%= product._id %>"
							class=" text-decoration-none stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
							<!-- Block2 -->
							<div class="block2">
								<div class="block2-pic hov-img0">
									<img src="products/<%= product.brand+' '+product.model+'/'+product.images[0].url %>"
										alt="IMG-PRODUCT">
								</div>

								<div class="block2-txt flex-w flex-t p-t-14">
									<div class="block2-txt-child1 flex-col-l text-decoration-none">
										<%= product.brand+" "+product.model %>
										<%  let greaterOffer;
											product.product_offer >= product.category.offer ? greaterOffer = product.product_offer : greaterOffer = product.category.offer ;   
										 	let offerPrice = product.variants[0].price - (greaterOffer/100) * product.variants[0].price ;
										%>
										<% if(greaterOffer){ %>
											<div class="stext-105 cl3 d-flex w-100 justify-content-between">
												<p class="bi bi-currency-rupee" style="font-size: medium;"><span class=""><%= offerPrice %></span></p>
												<div class="flex-r">
													<span class="me-2"><%= "-"+greaterOffer+"%" %></span>
													<span class="text-decoration-line-through text-danger"><%= product.variants[0].price.toLocaleString("en-IN") %></span>
												</div>
											</div>
										<% }else{ %>
											<div class="stext-105 cl3 d-flex w-100 justify-content-between">
												<p class="bi bi-currency-rupee" style="font-size: medium;"><span class=""><%= product.variants[0].price.toLocaleString("en-IN") %></span></p>
												<div class="flex-r">
													<span class="mx-1"></span>
													<span class="text-decoration-line-through text-danger"></span>
												</div>
											</div>
										<% } %>
									</div>
								</div>
							</div>
						</a>
					</div>
				<% }) %>

			</div>
		</div>
	</div>


	<!-- Footer -->
	<%- include("../layouts/footer.ejs") %>


	<!-- Back to top -->
	<div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
	</div>


	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function () {
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
	<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/slick/slick.min.js"></script>
	<script src="js/slick-custom.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/parallax100/parallax100.js"></script>
	<script>
		$('.parallax100').parallax100();
	</script>
	<!--===============================================================================================-->
	<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
	<script>
		$('.gallery-lb').each(function () { // the containers for all your galleries
			$(this).magnificPopup({
				delegate: 'a', // the selector for gallery item
				type: 'image',
				gallery: {
					enabled: true
				},
				mainClass: 'mfp-fade'
			});
		});
	</script>
	<!--===============================================================================================-->
	<script src="vendor/isotope/isotope.pkgd.min.js"></script>
	<!--===============================================================================================-->
	<script src="js/main.js"></script>

</body>

</html>